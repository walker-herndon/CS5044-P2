<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="https://d3js.org/d3.v7.min.js"></script>
        <link rel="stylesheet" href="styles.css">
        <title>CS5044 P2</title>
    </head>

    <body>
        <!-- 4x4 Table of MBTI Personalities -->
        <!-- Note: order is not final, unsure of correct organization -->
        <table>
            <tr>
                <td>INTJ</td>
                <td>INTP</td>
                <td>ENTJ</td>
                <td>ENTP</td>
            </tr>
            <tr>
                <td>INFJ</td>
                <td>INFP</td>
                <td>ENFJ</td>
                <td>ENFP</td>
            </tr>
            <tr>
                <td>ISTJ</td>
                <td>ISFJ</td>
                <td>ESTJ</td>
                <td>ESFJ</td>
            </tr>
            <tr>
                <td>ISTP</td>
                <td>ISFP</td>
                <td>ESTP</td>
                <td>ESFP</td>
            </tr>
        </table>

        <script>
            // Calculate distribution of MBTI personalities in data/merged.csv
            d3.csv('../data/merged.csv').then(function (data) {
                // Initialize count of each MBTI personality
                let mbtiCount = {
                    'INTJ': 0,
                    'INTP': 0,
                    'ENTJ': 0,
                    'ENTP': 0,
                    'INFJ': 0,
                    'INFP': 0,
                    'ENFJ': 0,
                    'ENFP': 0,
                    'ISTJ': 0,
                    'ISFJ': 0,
                    'ESTJ': 0,
                    'ESFJ': 0,
                    'ISTP': 0,
                    'ISFP': 0,
                    'ESTP': 0,
                    'ESFP': 0
                };

                // Count each MBTI personality
                data.forEach(function (d) {
                    mbtiCount[d.mbti] += 1;
                });

                // Remove "XXXX" personality
                delete mbtiCount['XXXX'];

                // Display count of each MBTI personality
                console.log(mbtiCount);

                // Create a bar chart of MBTI personalities
                const svg = d3.select('body').append('svg')
                    .attr('width', 1000)
                    .attr('height', 700);

                const margin = 60;
                const width = 1000 - 2 * margin;
                const height = 600 - 2 * margin;

                const chart = svg.append('g')
                    .attr('transform', `translate(${margin}, ${margin})`);

                const xScale = d3.scaleBand()
                    .range([0, width])
                    .domain(Object.keys(mbtiCount))
                    .padding(0.3);

                const yScale = d3.scaleLinear()
                    .range([height, 0])
                    .domain([0, d3.max(Object.values(mbtiCount))]);

                // Create x-axis
                chart.append('g')
                    .attr('transform', `translate(0, ${height})`)
                    .call(d3.axisBottom(xScale));

                // Create y-axis
                chart.append('g')
                    .call(d3.axisLeft(yScale));

                // Create bars
                chart.selectAll()
                    .data(Object.keys(mbtiCount))
                    .enter()
                    .append('rect')
                    .attr('x', (d) => xScale(d))
                    .attr('y', (d) => yScale(mbtiCount[d]))
                    .attr('height', (d) => height - yScale(mbtiCount[d]))
                    .attr('width', xScale.bandwidth())
                    .attr('fill', '#d3d3d3');

                // Create labels
                chart.selectAll()
                    .data(Object.keys(mbtiCount))
                    .enter()
                    .append('text')
                    .text((d) => mbtiCount[d])
                    .attr('x', (d) => xScale(d) + xScale.bandwidth() / 2)
                    .attr('y', (d) => yScale(mbtiCount[d]) - 10)
                    .attr('text-anchor', 'middle')
                    .attr('font-size', '14px')
                    .attr('fill', 'black');

                // Create title
                svg.append('text')
                    .attr('x', width / 2 + margin)
                    .attr('y', 40)
                    .attr('text-anchor', 'middle')
                    .attr('font-size', '20px')
                    .text('MBTI Personality Distribution');

                // Create x-axis label
                svg.append('text')
                    .attr('x', width / 2 + margin)
                    .attr('y', height + 2 * margin)
                    .attr('text-anchor', 'middle')
                    .attr('font-size', '16px')
                    .text('MBTI Personality');

                // Create y-axis label
                svg.append('text')
                    .attr('transform', 'rotate(-90)')
                    .attr('x', -height / 2)
                    .attr('y', margin - 20)
                    .attr('text-anchor', 'middle')
                    .attr('font-size', '16px')
                    .text('Count');
            });
        </script>

    </body>

</html>